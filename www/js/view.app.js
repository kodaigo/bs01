// Generated by CoffeeScript 1.4.0
(function() {


  define(['js/collection.todos', 'js/view.todolist', 'js/lib.honegumi', 'js/bg.tower', 'zepto', 'underscore', 'backbone'], function(Todos, TodoView, Honegumi, Temple, $, _, Backbone) {

    var AppView;
    AppView = Backbone.View.extend({
      el: $("#app"),
      events: {
        "click #btnAddTask": "addTask",
        "click #openDialog": "toggleDialog"
      },
      initialize: function() {
        console.log("--view app--");
        this.input = this.$("#AddTask");
        this.listenTo(Todos, 'add', this.addOne);
        this.listenTo(Todos, 'reset', this.addAll);
        this.listenTo(Todos, 'remove', this.completeTask);
        this.listenTo(Todos, 'all', this.render);
        this.main = $('#Main');
        this.dialogFlg = 0;
        app.layout = new Honegumi({
          header: false
        });
        app.layout.start();
        this.Temple = new Temple("backImage", app.layout.contents_w, app.layout.contents_h);
        Todos.fetch();
      },
      render: function() {
        console.log(arguments);
        console.log("--view app - render");
        $("#TodoNumber").html(Todos.length);
      },
      addOne: function(todo) {
        var view,
          _this = this;
        console.log("--view app - addOne");
        view = new TodoView({
          model: todo
        });
        this.$("#TodoList").append(view.render().el);
        view.$el.width(function() {
          return _this.$("#TodoList").width() - 6;
        }).animate({
          marginLeft: 6
        }, 300, 'swing', function() {
          app.layout.refresh();
        });
      },
      addAll: function() {
        Todos.each(this.addOne, this);
      },
      addTask: function(e) {
        if (!this.input.val()) {
          return;
        }
        Todos.create({
          title: this.input.val()
        });
        this.input.val('');
        return false;
      },
      completeTask: function() {
        console.log("--view app - complete");
      },
      toggleDialog: function() {
        console.log(this.dialogFlg);
        if (this.dialogFlg === 0) {
          this.dialogFlg = 1;
          $("#dialog").css('display', 'block');
          $("#dialog").animate({
            opacity: 1
          }, 500, "swing");
        } else {
          this.dialogFlg = 0;
          $("#dialog").animate({
            opacity: 0
          }, 500, "swing", function() {
            $("#dialog").css('display', 'none');
          });
        }
      }
    });
    return AppView;
  });

}).call(this);
