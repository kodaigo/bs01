// Generated by CoffeeScript 1.4.0
(function() {

  define(['js/collection.todos', 'js/view.todolist', 'zepto', 'underscore', 'backbone'], function(Todos, TodoView, $, _, Backbone) {
    var AppView;
    AppView = Backbone.View.extend({
      el: $("#app"),
      events: {
        "click #btnAddTask": "addTask"
      },
      initialize: function() {
        console.log("--view app--");
        this.input = this.$("#AddTask");
        this.listenTo(Todos, 'add', this.addOne);
        this.listenTo(Todos, 'reset', this.addAll);
        this.listenTo(Todos, 'remove', this.completeTask);
        this.listenTo(Todos, 'all', this.render);
        this.main = $('#Main');
        Todos.fetch();
      },
      render: function() {
        console.log(arguments);
        console.log("--view app - render");
        $("#TodoNumber").html(Todos.length);
      },
      addOne: function(todo) {
        var view,
          _this = this;
        console.log("--view app - addOne");
        view = new TodoView({
          model: todo
        });
        this.$("#TodoList").append(view.render().el);
        view.$el.width(function() {
          return _this.$("#TodoList").width() - 6;
        }).animate({
          marginLeft: 6
        }, 300, 'swing', function() {
          app.layout.refresh();
        });
      },
      addAll: function() {
        Todos.each(this.addOne, this);
      },
      addTask: function(e) {
        if (!this.input.val()) {
          return;
        }
        Todos.create({
          title: this.input.val()
        });
        this.input.val('');
        return false;
      },
      completeTask: function() {
        console.log("--view app - complete");
      }
    });
    return AppView;
  });

}).call(this);
